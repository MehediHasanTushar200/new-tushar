@model List<hamko.Controllers.ReportController.GroupReportViewModel>
@{
    ViewBag.Title = "Item Report";
    Layout = null;

    int stockSerial = 1;
    decimal totalQty = Model.Sum(g => g.TotalQty);
    decimal totalPrice = Model.Sum(g => g.TotalPrice);
    decimal totalAmount = Model.Sum(g => g.TotalAmount);
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>@ViewBag.Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        .table-container {
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: right;
        }

            th:first-child, td:first-child {
                text-align: center;
            }

            td:nth-child(2), th:nth-child(2) {
                text-align: left;
            }

        .ps-4 {
            padding-left: 1.5rem !important;
        }

        .ps-5 {
            padding-left: 3rem !important;
        }

        tr.pointer {
            cursor: pointer;
        }

            tr.pointer:hover {
                background-color: #cce5ff;
            }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4 text-primary">Item Report</h2>

        <div class="mb-3">
            <form method="post" asp-action="ReportByDate" class="row g-3 text-center">
                <div class="col-md-3">
                    <label class="form-label">From Date</label>
                    <input type="date" class="form-control" name="FromDate" required />
                </div>
                <div class="col-md-3">
                    <label class="form-label">To Date</label>
                    <input type="date" class="form-control" name="ToDate" required />
                </div>
                <div class="col-md-3 align-self-end">
                    <button type="submit" class="btn btn-primary">Generate</button>
                </div>
                <div class="col-md-3 align-self-end">
                    <button type="button" class="btn btn-success" onclick="printReport()">🖨️ Print</button>
                </div>
            </form>
        </div>

        <div id="printSection" class="table-container mt-4">
            <table class="table">
                <thead class="table-success text-center">
                    <tr>
                        <th rowspan="2">Sl</th>
                        <th rowspan="2">Particular</th>
                        <th colspan="3">Stock In</th>
                    </tr>
                    <tr>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-info text-white fw-bold pointer" data-bs-toggle="collapse" data-bs-target=".groupCollapse">
                        <td></td>
                        <td>Primary</td>
                        <td>@totalQty</td>
                        <td>@totalPrice.ToString("N2")</td>
                        <td>@totalAmount.ToString("N2")</td>
                    </tr>

                    @foreach (var group in Model)
                    {
                        <!-- Main Group Row -->
                        <tr class="table-secondary fw-semibold">
                            <td></td>
                            <td class="ps-4">@group.GroupName</td>
                            <td class="text-end">@group.TotalQty</td>
                            <td class="text-end">@group.TotalPrice.ToString("N2")</td>
                            <td class="text-end">@group.TotalAmount.ToString("N2")</td>
                        </tr>

                        <!-- Group Items -->
                        @foreach (var item in group.Items)
                        {
                            <tr class="table-light">
                                <td></td>
                                <td class="ps-5">• @item.ItemName</td>
                                <td class="text-end">@item.TotalQty</td>
                                <td class="text-end">@item.TotalPrice.ToString("N2")</td>
                                <td class="text-end">@item.TotalAmount.ToString("N2")</td>
                            </tr>
                            @foreach (var product in item.Products)
                            {
                                foreach (var stock in product.StockIns)
                                {
                                    <tr>
                                        <td class="text-center">@stockSerial++</td>
                                        <td class="ps-5">↳ @product.ProductName</td>
                                        <td class="text-end">@stock.Quantity</td>
                                        <td class="text-end">@stock.Price.ToString("N2")</td>
                                        <td class="text-end">@stock.Total.ToString("N2")</td>
                                    </tr>
                                }
                            }
                        }

                        <!-- SubGroups -->
                        @foreach (var sub in group.SubGroups)
                        {
                            <tr class="table-warning fw-semibold">
                                <td></td>
                                <td class="ps-5">▶ @sub.GroupName</td>
                                <td class="text-end">@sub.TotalQty</td>
                                <td class="text-end">@sub.TotalPrice.ToString("N2")</td>
                                <td class="text-end">@sub.TotalAmount.ToString("N2")</td>
                            </tr>

                            @foreach (var item in sub.Items)
                            {
                                <tr class="table-light">
                                    <td></td>
                                    <td class="ps-5">• @item.ItemName</td>
                                    <td class="text-end">@item.TotalQty</td>
                                    <td class="text-end">@item.TotalPrice.ToString("N2")</td>
                                    <td class="text-end">@item.TotalAmount.ToString("N2")</td>
                                </tr>
                                @foreach (var product in item.Products)
                                {
                                    foreach (var stock in product.StockIns)
                                    {
                                        <tr>
                                            <td class="text-center">@stockSerial++</td>
                                            <td class="ps-5">↳ @product.ProductName</td>
                                            <td class="text-end">@stock.Quantity</td>
                                            <td class="text-end">@stock.Price.ToString("N2")</td>
                                            <td class="text-end">@stock.Total.ToString("N2")</td>
                                        </tr>
                                    }
                                }
                            }
                        }
                    }


                    }
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function printReport() {
            var printContents = document.getElementById('printSection').innerHTML;
            var originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
            location.reload();
        }
    </script>
</body>
</html>
