@model List<hamko.Controllers.ReportController.GroupReportViewModel>
@{
    ViewBag.Title = "Stock Report";
    Layout = null;

    decimal totalInQty = Model.Sum(g => g.TotalQty);
    decimal totalInPrice = Model.Sum(g => g.TotalPrice);
    decimal totalInAmount = Model.Sum(g => g.TotalAmount);
    decimal totalOutQty = Model.Sum(g => g.TotalOutQty);
    decimal totalOutPrice = Model.Sum(g => g.TotalOutPrice);
    decimal totalOutAmount = Model.Sum(g => g.TotalOutAmount);
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>@ViewBag.Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center text-primary">Stock Group Summary</h2>

        <form method="post" asp-action="Index" class="row g-3 mb-4">
            <div class="col-md-3">
                <label class="form-label">From Date</label>
                <input type="date" name="FromDate" class="form-control" required />
            </div>
            <div class="col-md-3">
                <label class="form-label">To Date</label>
                <input type="date" name="ToDate" class="form-control" required />
            </div>
            <div class="col-md-3 align-self-end">
                <button type="submit" class="btn btn-primary">Generate</button>
            </div>
            <div class="col-md-3 align-self-end">
                <button type="button" onclick="window.print()" class="btn btn-success">🖨️ Print</button>
            </div>
        </form>

        <table class="table table-bordered table-hover">
            <thead class="table-success text-center">
                <tr>
                    <th rowspan="2">#</th>
                    <th rowspan="2">Particular</th>
                    <th colspan="3">Stock In</th>
                    <th colspan="3">Stock Out</th>
                </tr>
                <tr>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                <tr class="table-info fw-bold">
                    <td></td>
                    <td>Primary</td>
                    <td class="text-end">@totalInQty</td>
                    <td class="text-end">@totalInPrice.ToString("N2")</td>
                    <td class="text-end">@totalInAmount.ToString("N2")</td>
                    <td class="text-end">@totalOutQty</td>
                    <td class="text-end">@totalOutPrice.ToString("N2")</td>
                    <td class="text-end">@totalOutAmount.ToString("N2")</td>
                </tr>

                @foreach (var g in Model)
                {
                    if (g.TotalQty == 0 && g.TotalOutQty == 0)
                    {
                        continue;
                    }

                    <tr class="table-secondary fw-semibold">
                        <td></td>
                        <td>@g.GroupName</td>
                        <td class="text-end">@g.TotalQty</td>
                        <td class="text-end">@g.TotalPrice.ToString("N2")</td>
                        <td class="text-end">@g.TotalAmount.ToString("N2")</td>
                        <td class="text-end">@g.TotalOutQty</td>
                        <td class="text-end">@g.TotalOutPrice.ToString("N2")</td>
                        <td class="text-end">@g.TotalOutAmount.ToString("N2")</td>
                    </tr>

                    @foreach (var item in g.Items)
                    {
                        if (item.TotalQty == 0 && item.TotalOutQty == 0)
                        {
                            continue;
                        }

                        <tr>
                            <td></td>
                            <td class="ps-4">• @item.ItemName</td>
                            <td class="text-end">@item.TotalQty</td>
                            <td class="text-end">@item.TotalPrice.ToString("N2")</td>
                            <td class="text-end">@item.TotalAmount.ToString("N2")</td>
                            <td class="text-end">@item.TotalOutQty</td>
                            <td class="text-end">@item.TotalOutPrice.ToString("N2")</td>
                            <td class="text-end">@item.TotalOutAmount.ToString("N2")</td>
                        </tr>
                    }

                    @foreach (var sub in g.SubGroups)
                    {
                        if (sub.TotalQty == 0 && sub.TotalOutQty == 0)
                        {
                            continue;
                        }

                        <tr class="table-warning">
                            <td></td>
                            <td class="ps-3">▶ @sub.GroupName</td>
                            <td class="text-end">@sub.TotalQty</td>
                            <td class="text-end">@sub.TotalPrice.ToString("N2")</td>
                            <td class="text-end">@sub.TotalAmount.ToString("N2")</td>
                            <td class="text-end">@sub.TotalOutQty</td>
                            <td class="text-end">@sub.TotalOutPrice.ToString("N2")</td>
                            <td class="text-end">@sub.TotalOutAmount.ToString("N2")</td>
                        </tr>

                        @foreach (var item in sub.Items)
                        {
                            if (item.TotalQty == 0 && item.TotalOutQty == 0)
                            {
                                continue;
                            }

                            <tr>
                                <td></td>
                                <td class="ps-5">• @item.ItemName</td>
                                <td class="text-end">@item.TotalQty</td>
                                <td class="text-end">@item.TotalPrice.ToString("N2")</td>
                                <td class="text-end">@item.TotalAmount.ToString("N2")</td>
                                <td class="text-end">@item.TotalOutQty</td>
                                <td class="text-end">@item.TotalOutPrice.ToString("N2")</td>
                                <td class="text-end">@item.TotalOutAmount.ToString("N2")</td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>

        <a class="btn btn-secondary" href="@Url.Action("Index", "Dashboard")">
            ← Back
        </a>
    </div>
</body>
</html>
